# dockerfile-enhance.nvim ä½¿ç”¨æŒ‡å—

## ğŸ¯ è™šæ‹Ÿæ–‡æœ¬æ¨¡å¼

æ’ä»¶ç°åœ¨ä½¿ç”¨ **è™šæ‹Ÿæ–‡æœ¬æ¨¡å¼**ï¼Œè¿™æ„å‘³ç€ï¼š
- âœ… åˆ†éš”çº¿é€šè¿‡ Neovim çš„è™šæ‹Ÿæ–‡æœ¬æ˜¾ç¤º
- âœ… **ä¸ä¼šä¿®æ”¹å®é™…çš„ Dockerfile å†…å®¹**
- âœ… **ä¸ä¼šå¯¼è‡´ Dockerfile è¯­æ³•é”™è¯¯**
- âœ… åˆ†éš”çº¿åªåœ¨ç¼–è¾‘å™¨ä¸­å¯è§ï¼Œä¿å­˜æ–‡ä»¶æ—¶ä¸ä¼šåŒ…å«åˆ†éš”ç¬¦

## å¿«é€Ÿæµ‹è¯•

### 1. å¯åŠ¨ Neovim å¹¶æ‰“å¼€æµ‹è¯•æ–‡ä»¶

```bash
# æ‰“å¼€æµ‹è¯• Dockerfile
nvim test.Dockerfile
```

### 2. æ‰‹åŠ¨æ‰§è¡Œæ’ä»¶å‘½ä»¤

åœ¨ Neovim ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```vim
:DockerfileEnhance
```

æ‚¨åº”è¯¥çœ‹åˆ°ï¼š
- é€šçŸ¥æ¶ˆæ¯ï¼š"Dockerfile å·²å¢å¼ºï¼Œæ˜¾ç¤º X ä¸ªè™šæ‹Ÿåˆ†éš”ç¬¦"
- åœ¨å¤šä¸ª FROM æŒ‡ä»¤ä¹‹é—´å‡ºç°è™šæ‹Ÿåˆ†éš”çº¿
- **æ–‡ä»¶å†…å®¹ä¿æŒä¸å˜ï¼Œæ²¡æœ‰è¯­æ³•é”™è¯¯**

### 3. å…¶ä»–å¯ç”¨å‘½ä»¤

```vim
:DockerfileShowInfo      " æ˜¾ç¤ºæ‰€æœ‰ FROM æŒ‡ä»¤ä¿¡æ¯
:DockerfileHideSeparators  " éšè—è™šæ‹Ÿåˆ†éš”çº¿
:DockerfileToggleSeparators  " åˆ‡æ¢è™šæ‹Ÿåˆ†éš”çº¿æ˜¾ç¤º
```

## è‡ªåŠ¨æ¨¡å¼æµ‹è¯•

### 1. ç¡®ä¿è‡ªåŠ¨æ¨¡å¼å·²å¯ç”¨

æ’ä»¶é»˜è®¤å¯ç”¨è‡ªåŠ¨æ¨¡å¼ã€‚å½“æ‚¨æ‰“å¼€ Dockerfile æ–‡ä»¶æ—¶ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºè™šæ‹Ÿåˆ†éš”çº¿ã€‚

### 2. æµ‹è¯•è‡ªåŠ¨åŠŸèƒ½

```bash
# æ‰“å¼€ä¸€ä¸ªå¤šé˜¶æ®µæ„å»ºçš„ Dockerfile
nvim examples/multi-stage.Dockerfile
```

æ’ä»¶åº”è¯¥è‡ªåŠ¨åœ¨å¤šä¸ª FROM æŒ‡ä»¤ä¹‹é—´æ˜¾ç¤ºè™šæ‹Ÿåˆ†éš”çº¿ã€‚

## è™šæ‹Ÿæ–‡æœ¬æ¨¡å¼çš„ä¼˜åŠ¿

### ğŸ”’ **è¯­æ³•å®‰å…¨**
- ä¸ä¼šä¿®æ”¹ Dockerfile çš„å®é™…å†…å®¹
- ä¸ä¼šå¯¼è‡´ Docker æ„å»ºé”™è¯¯
- ä¿å­˜æ–‡ä»¶æ—¶ä¸ä¼šåŒ…å«åˆ†éš”ç¬¦å­—ç¬¦

### ğŸ‘ï¸ **è§†è§‰å¢å¼º**
- åˆ†éš”çº¿åªåœ¨ç¼–è¾‘å™¨ä¸­å¯è§
- æé«˜å¤šé˜¶æ®µæ„å»ºçš„å¯è¯»æ€§
- å¯ä»¥éšæ—¶éšè—æˆ–æ˜¾ç¤º

### âš¡ **å®æ—¶æ›´æ–°**
- å½“æ‚¨ç¼–è¾‘ Dockerfile æ—¶ï¼Œåˆ†éš”çº¿ä¼šè‡ªåŠ¨æ›´æ–°
- æ”¯æŒå®æ—¶æ£€æµ‹ FROM æŒ‡ä»¤çš„å˜åŒ–

## æ•…éšœæ’é™¤

### æ’ä»¶æ²¡æœ‰æ•ˆæœï¼Ÿ

1. **æ£€æŸ¥æ’ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½**ï¼š
   ```vim
   :lua print(vim.fn.exists(":DockerfileEnhance"))
   ```
   åº”è¯¥è¿”å› `2`ï¼ˆå‘½ä»¤å­˜åœ¨ï¼‰

2. **æ£€æŸ¥æ–‡ä»¶ç±»å‹**ï¼š
   ```vim
   :set filetype?
   ```
   åº”è¯¥æ˜¾ç¤º `dockerfile`

3. **æ‰‹åŠ¨åŠ è½½æ’ä»¶**ï¼š
   ```vim
   :lua require('dockerfile-enhance').setup()
   ```

4. **æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ª FROM æŒ‡ä»¤**ï¼š
   ```vim
   :DockerfileShowInfo
   ```

### è™šæ‹Ÿåˆ†éš”çº¿æ²¡æœ‰æ˜¾ç¤ºï¼Ÿ

1. **æ£€æŸ¥è™šæ‹Ÿæ–‡æœ¬è®¾ç½®**ï¼š
   ```vim
   :lua require('dockerfile-enhance').setup({enable_virtual_text = true})
   ```

2. **æ‰‹åŠ¨åˆ·æ–°è™šæ‹Ÿåˆ†éš”çº¿**ï¼š
   ```vim
   :lua require('dockerfile-enhance').refresh_virtual_separators()
   ```

3. **æ£€æŸ¥ Neovim ç‰ˆæœ¬**ï¼š
   è™šæ‹Ÿæ–‡æœ¬éœ€è¦ Neovim 0.6.0 æˆ–æ›´é«˜ç‰ˆæœ¬

## é…ç½®é€‰é¡¹

### è™šæ‹Ÿæ–‡æœ¬é…ç½®

```lua
require('dockerfile-enhance').setup({
    separator_char = "â”€",      -- åˆ†éš”ç¬¦å­—ç¬¦
    separator_length = 80,     -- åˆ†éš”ç¬¦é•¿åº¦
    highlight_group = "Comment", -- é«˜äº®ç»„
    auto_enhance = true,       -- è‡ªåŠ¨å¢å¼º
    enable_highlights = true,  -- å¯ç”¨é«˜äº®
    enable_virtual_text = true, -- å¯ç”¨è™šæ‹Ÿæ–‡æœ¬ï¼ˆæ¨èï¼‰
    virtual_highlight_group = "Comment", -- è™šæ‹Ÿæ–‡æœ¬é«˜äº®ç»„
})
```

### è‡ªå®šä¹‰è™šæ‹Ÿåˆ†éš”ç¬¦

```lua
require('dockerfile-enhance').setup({
    separator_char = "=",      -- ä½¿ç”¨ç­‰å·ä½œä¸ºåˆ†éš”ç¬¦
    separator_length = 60,     -- åˆ†éš”ç¬¦é•¿åº¦
    virtual_highlight_group = "Special", -- ä½¿ç”¨ç‰¹æ®Šé«˜äº®ç»„
})
```

### ç¦ç”¨è™šæ‹Ÿæ–‡æœ¬

```lua
require('dockerfile-enhance').setup({
    enable_virtual_text = false
})
```

## ç¤ºä¾‹æ•ˆæœ

### åŸå§‹ Dockerfileï¼ˆæ–‡ä»¶å†…å®¹ï¼‰
```dockerfile
FROM node:18-alpine AS base
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM base AS development
RUN npm ci
COPY . .
CMD ["npm", "run", "dev"]

FROM base AS production
COPY . .
RUN npm run build
CMD ["npm", "start"]
```

### ç¼–è¾‘å™¨ä¸­çš„æ˜¾ç¤ºæ•ˆæœ
```
FROM node:18-alpine AS base
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FROM base AS development
RUN npm ci
COPY . .
CMD ["npm", "run", "dev"]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FROM base AS production
COPY . .
RUN npm run build
CMD ["npm", "start"]
```

**æ³¨æ„**ï¼šåˆ†éš”çº¿åªåœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºï¼Œä¿å­˜æ–‡ä»¶æ—¶ä»ç„¶æ˜¯åŸå§‹çš„ Dockerfile å†…å®¹ã€‚

## è°ƒè¯•ä¿¡æ¯

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥è¿è¡Œè¯Šæ–­è„šæœ¬ï¼š

```bash
nvim -l debug_plugin.lua
```

æˆ–è€…è¿è¡Œè™šæ‹Ÿæ–‡æœ¬æµ‹è¯•ï¼š

```bash
nvim -l test_virtual.lua
```

## æŠ€æœ¯è¯´æ˜

æ’ä»¶ä½¿ç”¨ Neovim çš„ `extmark` API æ¥æ˜¾ç¤ºè™šæ‹Ÿæ–‡æœ¬ï¼š
- è™šæ‹Ÿæ–‡æœ¬ä¸ä¼šå½±å“æ–‡ä»¶çš„å®é™…å†…å®¹
- åˆ†éš”çº¿æ˜¾ç¤ºåœ¨ FROM æŒ‡ä»¤è¡Œçš„æœ«å°¾
- æ”¯æŒè‡ªå®šä¹‰é«˜äº®å’Œæ ·å¼
- å®æ—¶å“åº”æ–‡ä»¶å†…å®¹å˜åŒ– 